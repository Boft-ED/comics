const toggleTheme = document.querySelectorAll('.toggle-theme')
let el = document.documentElement
let trans = () => {
    document.documentElement.classList.add('transition');
    window.setTimeout(() => {
        document.documentElement.classList.remove('transition')
    }, 1000)
}
for (let i = 0; i < toggleTheme.length; i++) {
    toggleTheme[i].addEventListener("click", function () {
        if (el.hasAttribute('data-theme')) {
            trans()
            el.removeAttribute('data-theme', 'dark')
        } else {
            trans()
            el.setAttribute('data-theme', 'dark')
        }
    });
}

const headerViewMode = document.querySelectorAll('.header-view-mode');
const toggleThemeId = document.querySelectorAll('#toggle-theme');
const iconTheme = document.querySelectorAll('#icon-theme');

if (headerViewMode.length < 1) {
    const headerLogo = document.querySelectorAll('#header-logo');
    const headerLogoBurger = document.querySelectorAll('#header-logo-burger');
    const burgerMenu = document.querySelectorAll('#burger-menu-mobile');
    const burgerClose = document.querySelectorAll('#burger-close-mobile');
    const iconLang = document.querySelectorAll('#icon-lang');
    const magnifier = document.querySelectorAll('#magnifier');

    for (let i = 0; i < toggleThemeId.length; i++) {

        toggleThemeId[i].onclick = function () {
            if (nightMode === false) {
                nightMode = true;
                trans()
                headerLogo[0].setAttribute("src", "img/logo/logo-header-white.png");
                headerLogo[1].setAttribute("src", "img/logo/logo-header-white.png");
                headerLogoBurger[0].setAttribute("src", "img/logo/logo-header-white.png");
                burgerMenu[0].setAttribute("src", "img/icons/burger-menu-light.svg");
                burgerClose[0].setAttribute("src", "img/icons/close-light.svg");
                iconLang[0].setAttribute("src", "img/icons/world-light.svg");
                magnifier[0].setAttribute("src", "img/icons/magnifier-light.svg");
                iconTheme[0].setAttribute("src", "img/icons/light.svg");
            } else {
                nightMode = false;
                trans()
                headerLogo[0].setAttribute("src", "img/logo/Logo-header.png");
                headerLogo[1].setAttribute("src", "img/logo/Logo-header.png");
                headerLogoBurger[0].setAttribute("src", "img/logo/Logo-header.png");
                burgerMenu[0].setAttribute("src", "img/icons/burger-menu.svg");
                burgerClose[0].setAttribute("src", "img/icons/close.svg");
                iconLang[0].setAttribute("src", "img/icons/world.svg");
                magnifier[0].setAttribute("src", "img/icons/magnifier.svg");
                iconTheme[0].setAttribute("src", "img/icons/night.svg");
            }
        }
    }
} else {
    const iconChapters = document.querySelectorAll('#icon-chapters');
    const iconQuestion = document.querySelectorAll('#icon-question');

    for (let i = 0; i < toggleThemeId.length; i++) {

        toggleThemeId[i].onclick = function () {
            if (nightMode === false) {
                nightMode = true;
                trans();
                iconTheme[0].setAttribute("src", "img/icons/light-grey.svg");
                iconChapters[0].setAttribute("src", "img/icons/chapters-grey.svg");
                iconQuestion[0].setAttribute("src", "img/icons/question-grey.svg");


            } else {
                nightMode = false;
                trans();
                iconTheme[0].setAttribute("src", "img/icons/night.svg");
                iconChapters[0].setAttribute("src", "img/icons/chapters.svg");
                iconQuestion[0].setAttribute("src", "img/icons/question.svg");
            }
        }
    }
}

let nightMode = false;


var header = $('.header-view-mode');
var tools = $('.block-view-comics__tools'),
    scrollPrev = 0;

$(window).scroll(function () {
    var scrolled = $(window).scrollTop();

    if (scrolled > 100 && scrolled > scrollPrev) {
        tools.addClass('out-right');
        header.addClass('out');
    } else {
        tools.removeClass('out-right');
        header.removeClass('out');
    }
    scrollPrev = scrolled;
});

var stickySidebar = $('.sticky');

if (stickySidebar.length > 0) {
    var stickyHeight = stickySidebar.height(),
        sidebarTop = stickySidebar.offset().top;
}

// on scroll move the sidebar
$(window).scroll(function () {
    if (stickySidebar.length > 0) {
        var scrollTop = $(window).scrollTop();

        if (sidebarTop < scrollTop) {
            stickySidebar.css('top', scrollTop - sidebarTop);

            // stop the sticky sidebar at the footer to avoid overlapping
            var sidebarBottom = stickySidebar.offset().top + stickyHeight,
                stickyStop = $('.main-content').offset().top + $('.main-content').height();
            if (stickyStop < sidebarBottom) {
                var stopPosition = $('.main-content').height() - stickyHeight;
                stickySidebar.css('top', stopPosition);
            }
        }
        else {
            stickySidebar.css('top', '0');
        }
    }
});

$(window).resize(function () {
    if (stickySidebar.length > 0) {
        stickyHeight = stickySidebar.height();
    }
});

window.addEventListener('scroll', function () {
    window.dispatchEvent(new Event('resize'));
});

var btn = document.querySelectorAll('.answer-show-btn span');
for (var i = 0; i < btn.length; i++) {
    btn[i].onclick = function (target) {
        if (this.innerHTML == "ПОКАЗАТЬ ОТВЕТЫ") {
            this.innerHTML = "СКРЫТЬ ОТВЕТЫ";
        } else {
            this.innerHTML = "ПОКАЗАТЬ ОТВЕТЫ";
        }
    }
}

$(document).ready(function () {
    let burger_i = 0;
    $(".account-menu").click(function () {
        if (burger_i % 2 == 0) {
            $('.menu').addClass("opened");
            $('.menu').removeClass("closed");
        } else {
            $('.menu').addClass("closed");
            $('.menu').removeClass("opened");
        }
        burger_i++;
    });

    $('#burger-menu').click(function () {
        $(this).toggleClass('open');
    });
});

$('.cd-popup-trigger-question').on('click', function (event) {
    event.preventDefault();
    $('.cd-popup-question').addClass('is-visible');
});

//close popup
$('.cd-popup-question').on('click', function (event) {
    if ($(event.target).is('.cd-popup-close') || $(event.target).is('.cd-popup-question')) {
        event.preventDefault();
        $(this).removeClass('is-visible');
    }
});
//close popup when clicking the esc keyboard button
$(document).keyup(function (event) {
    if (event.which == '27') {
        $('.cd-popup-question').removeClass('is-visible');
    }
});



$('.cd-popup-trigger').on('click', function (event) {
    event.preventDefault();
    $('.cd-popup').addClass('is-visible');
});

//close popup
$('.cd-popup').on('click', function (event) {
    if ($(event.target).is('.cd-popup-close') || $(event.target).is('.cd-popup')) {
        event.preventDefault();
        $(this).removeClass('is-visible');
    }
});
//close popup when clicking the esc keyboard button
$(document).keyup(function (event) {
    if (event.which == '27') {
        $('.cd-popup').removeClass('is-visible');
    }
});


$(".search-btn").click(function () {
    $(".search-wrapper").addClass("active");
    $(this).css("display", "none");
    $(".search-data").fadeIn(500);
    $(".close-btn").fadeIn(500);
    $(".search-data .line").addClass("active");
    setTimeout(function () {
        $("input").focus();
        $(".search-data label").fadeIn(500);
        $(".search-data span").fadeIn(500);
    }, 800);
    $("body").addClass("open");
});
$(".close-btn").click(function () {
    $(".search-wrapper").removeClass("active");
    $(".search-btn").fadeIn(800);
    $(".search-data").fadeOut(500);
    $(".close-btn").fadeOut(500);
    $(".search-data .line").removeClass("active");
    $("input").val("");
    $(".search-data label").fadeOut(500);
    $(".search-data span").fadeOut(500);
    $("body").removeClass("open");
});

for (const dropdown of document.querySelectorAll(".custom-select-wrapper")) {
    dropdown.addEventListener('click', function () {
        this.querySelector('.custom-select').classList.toggle('open');
    })
}

window.addEventListener('click', function (e) {
    for (const select of document.querySelectorAll('.custom-select')) {
        if (!select.contains(e.target)) {
            select.classList.remove('open');
        }
    }
});


for (const option of document.querySelectorAll(".custom-option")) {
    option.addEventListener('click', function () {
        if (!this.classList.contains('selected')) {
            this.parentNode.querySelector('.custom-option.selected').classList.remove('selected');
            this.classList.add('selected');
            this.closest('.custom-select').querySelector('.custom-select__trigger span').textContent = this.textContent;
        }
    })
}

$(function () {

    var pathname_url = window.location.pathname;
    var href_url = window.location.href;

    $(".nav-menu li").each(function () {

        var link = $(this).find("a").attr("href");

        if (pathname_url == link || href_url == link) {

            $(this).addClass("active-nav-item");

        }

    });

});

if (window.location.href == 'https://comics1.gitlab.io/comics/index-18+.html') {
    $('.header__age').addClass('age-active');
};



$(document).ready(function () {

    $(".answer-show-btn").click(function () {
        $(this).find(".comments-card__answer").toggleClass("collapsed");
        $(this).parent().toggleClass("active");
    });

});


var swiper = new Swiper(".hero", {
    slidesPerView: 1.1,
    autoplay:
    {
        delay: 3500,
    },
    loop: true,
});

var swiper = new Swiper(".filter", {
    direction: "horizontal",
    slidesPerView: 5.5,
    autoplay:
    {
        delay: 3500,
    },
    breakpoints: {
        320: {
            slidesPerView: 3.5,
            direction: "horizontal",
        },
        420: {
            slidesPerView: 3.5,
            direction: "horizontal",
        },
        620: {
            slidesPerView: 4.5,
            direction: "horizontal",
        },
        840: {
            slidesPerView: 5.5,
            direction: "horizontal",
        },
        991: {
            slidesPerView: 3,
            direction: "vertical",
        }
    },
    loop: true,
});

var swiper = new Swiper('.carousel-one', {
    slidesPerView: 9.5,
    loop: true,
    autoplay:
    {
        delay: 3500,
    },
    breakpoints: {
        320: {
            slidesPerView: 3.5,
        },
        420: {
            slidesPerView: 3.5,
        },
        620: {
            slidesPerView: 4.5,
        },
        840: {
            slidesPerView: 5.5,
        },
        // when window width is >= 480px
        1050: {
            slidesPerView: 6.5,
        },
        1300: {
            slidesPerView: 7.5,
        },
        // when window width is >= 640px
        1650: {
            slidesPerView: 9.5,
        },
        2670: {
            slidesPerView: 25.5,
        }
    }
});

var swiper = new Swiper('.carousel-six', {
    slidesPerView: 2,
    loop: true,
    autoplay:
    {
        delay: 1500,
    },
    breakpoints: {
        210: {
            slidesPerView: 3.5,
        },
        470: {
            slidesPerView: 3.5,
        },
        580: {
            slidesPerView: 1.5,
        },
        1300: {
            slidesPerView: 2,
        },
        // when window width is >= 640px
        1600: {
            slidesPerView: 2,
        }
    }
});

var swiper = new Swiper('.carousel-two', {
    slidesPerView: 8.5,
    spaceBetween: 0,
    loop: true,
    breakpoints: {
        320: {
            slidesPerView: 3.5,
            spaceBetween: 20
        },
        620: {
            slidesPerView: 3.5,
            spaceBetween: 20
        },
        840: {
            slidesPerView: 4.5,
            spaceBetween: 20
        },
        // when window width is >= 480px
        1050: {
            slidesPerView: 5.5,
        },
        1300: {
            slidesPerView: 6.5,
        },
        // when window width is >= 640px
        1650: {
            slidesPerView: 8.5,
            spaceBetween: 40
        },
        2670: {
            slidesPerView: 25.5,
        }
    }
});

var swiper = new Swiper('.carousel-three', {
    slidesPerView: 6,
    spaceBetween: 0,
    loop: true,
    autoplay:
    {
        delay: 3500,
    },
    breakpoints: {
        320: {
            slidesPerView: 4.5,
            spaceBetween: 20
        },
        620: {
            slidesPerView: 4.5,
            spaceBetween: 20
        },
        840: {
            slidesPerView: 4.5,
        },
        // when window width is >= 480px
        1050: {
            slidesPerView: 5.5,
        },
        1300: {
            slidesPerView: 7.5,
        },
        // when window width is >= 640px
        1650: {
            slidesPerView: 9.5,
        },
        2670: {
            slidesPerView: 25.5,
        }
    }
});

var swiper = new Swiper('.carousel-four', {
    loop: true,
    autoplay:
    {
        delay: 3500,
    },
    breakpoints: {
        320: {
            slidesPerView: 1.5,
            spaceBetween: 20,
        },
        480: {
            spaceBetween: 20,
            slidesPerView: 1.5,
        },
        580: {
            spaceBetween: 20,
            slidesPerView: 1.5,
        },
        990: {
            spaceBetween: 20,
            slidesPerView: 2.5,
        },
        // when window width is >= 480px
        1050: {
            spaceBetween: 20,
            slidesPerView: 2.5,
        },
        1300: {
            spaceBetween: 20,
            slidesPerView: 2.5,
        },
        // when window width is >= 640px
        1600: {
            spaceBetween: 20,
            slidesPerView: 2.5,
        },
        2670: {
            slidesPerView: 25.5,
        }
    }
});

var swiper = new Swiper('.carousel-five', {
    slidesPerView: 3,
    spaceBetween: 0,
    loop: true,
    autoplay:
    {
        delay: 1500,
    },
});
